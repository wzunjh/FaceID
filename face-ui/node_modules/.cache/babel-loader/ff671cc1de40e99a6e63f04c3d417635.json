{"ast":null,"code":"import \"core-js/modules/web.timers.js\";\nimport $camera from \"../../camera/index.js\";\nexport default {\n  data: function data() {\n    return {\n      size: 5,\n      current: 1,\n      total: 0,\n      videoWidth: 200,\n      videoHeight: 200,\n      faceImgState: false,\n      searchFace: {\n        faceName: '',\n        faceStatus: ''\n      },\n      tableData: [],\n      selectImgDialog: false,\n      currentImg: '',\n      saveAndUpdateDialog: false,\n      saveAndUpdateTitle: '',\n      faceObj: {\n        fid: null,\n        faceName: '',\n        faceBase: '',\n        faceStatus: 0,\n        remark: '',\n        addAndUpdateState: false\n      },\n      rules: {\n        faceName: [{\n          required: true,\n          message: '请输入人脸名称',\n          trigger: 'blur'\n        }, {\n          min: 2,\n          max: 5,\n          message: '长度在 2 到 5 个字符',\n          trigger: 'blur'\n        }],\n        faceBase: [{\n          required: true,\n          message: '人脸数据不能为空'\n        }]\n      },\n      faceOption: {},\n      cameraState: false\n    };\n  },\n  watch: {\n    saveAndUpdateDialog: {\n      handler: function handler(newValue, oldValue) {\n        var _this = this;\n\n        // 监听弹出层 设置摄像头是否开启\n        if (newValue) {\n          // 延迟加载 不然document.getElementById找不到\n          setTimeout(function () {\n            // 开启摄像头\n            _this.faceOption = $camera.getCamera({\n              videoWidth: 200,\n              videoHeight: 200,\n              thisCancas: null,\n              thisContext: null,\n              thisVideo: null,\n              canvasId: 'canvasCamera2',\n              videoId: 'videoCamera2'\n            });\n          }, 1000);\n        } else {\n          var faceBase = document.getElementById(\"faceBase\");\n          faceBase.innerHTML = \"\";\n\n          if (this.faceOption.thisVideo != null) {\n            // 不等于null 关闭摄像头\n            this.faceOption.thisVideo.srcObject.getTracks()[0].stop();\n          }\n        }\n      }\n    }\n  },\n  // 获取人脸数据\n  created: function created() {\n    this.getFaceList();\n  },\n  methods: {\n    // 录入\n    enteringFace: function enteringFace() {\n      this.faceObj.faceBase = $camera.draw(this.faceOption);\n      var faceBase = document.getElementById(\"faceBase\");\n      faceBase.innerHTML = \"<img src='\" + this.faceObj.faceBase + \"' />\";\n    },\n    // 增加|修改\n    submitForm: function submitForm(formName) {\n      var _this2 = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          _this2.$http.post(\"/face/\" + (_this2.addAndUpdateState ? 'save' : 'update'), _this2.faceObj).then(function (res) {\n            _this2.$message({\n              showClose: true,\n              message: res.data.msg,\n              type: 'success',\n              duration: 3000\n            });\n\n            _this2.getFaceList();\n\n            _this2.saveAndUpdateDialog = false;\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n    // 重置表单\n    resetForm: function resetForm(formName) {\n      var faceBase = document.getElementById(\"faceBase\");\n      faceBase.innerHTML = \"\";\n      this.$refs[formName].resetFields();\n    },\n    // 查看人脸\n    selectImg: function selectImg(faceBase) {\n      this.selectImgDialog = true;\n      this.currentImg = faceBase;\n    },\n    // 获取人脸列表\n    getFaceList: function getFaceList() {\n      var _this3 = this;\n\n      this.$http.get('/face/faceList', {\n        params: {\n          current: this.current,\n          size: this.size,\n          faceName: this.searchFace.faceName,\n          faceStatus: this.searchFace.faceStatus\n        }\n      }).then(function (res) {\n        _this3.tableData = res.data.data.records;\n        _this3.size = res.data.data.size;\n        _this3.current = res.data.data.current;\n        _this3.total = res.data.data.total;\n      });\n    },\n    // 分页\n    handleSizeChange: function handleSizeChange(val) {\n      this.size = val;\n      this.getFaceList();\n    },\n    // 分页\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.current = val;\n      this.getFaceList();\n    },\n    // 关闭弹出层\n    handleClose: function handleClose() {\n      this.saveAndUpdateDialog = false;\n      this.cameraState = false;\n      this.resetForm('ruleForm');\n    },\n    // 设置按钮的延迟加载\n    setCameraState: function setCameraState() {\n      var _this4 = this;\n\n      setTimeout(function () {\n        _this4.cameraState = true;\n      }, 1500);\n    },\n    // 添加\n    handleSave: function handleSave() {\n      this.setCameraState();\n      this.addAndUpdateState = true;\n      this.saveAndUpdateDialog = true;\n      this.saveAndUpdateTitle = '添加人脸';\n    },\n    // 修改\n    handleEdit: function handleEdit(index, row) {\n      var _this5 = this;\n\n      this.setCameraState();\n      this.addAndUpdateState = false;\n      this.saveAndUpdateDialog = true;\n      this.saveAndUpdateTitle = '修改人脸';\n      this.$http.get(\"/face/info/\" + row.fid).then(function (res) {\n        _this5.faceObj = res.data.data;\n        var faceBase = document.getElementById(\"faceBase\");\n        faceBase.innerHTML = \"<img src='\" + _this5.faceObj.faceBase + \"' />\";\n      });\n    },\n    //删除\n    handleDelete: function handleDelete(index, row) {\n      var _this6 = this;\n\n      console.log(index, row);\n      this.$http.get(\"/face/faceDelete/\" + row.fid).then(function (res) {\n        _this6.getFaceList();\n\n        _this6.$message.success(res.data.msg);\n      });\n    }\n  }\n};","map":{"version":3,"mappings":";AA0NA;AACA;EACAA,IADA,kBACA;IACA;MACAC,OADA;MAEAC,UAFA;MAGAC,QAHA;MAIAC,eAJA;MAKAC,gBALA;MAMAC,mBANA;MAOAC;QACAC,YADA;QAEAC;MAFA,CAPA;MAWAC,aAXA;MAYAC,sBAZA;MAaAC,cAbA;MAcAC,0BAdA;MAeAC,sBAfA;MAgBAC;QACAC,SADA;QAEAR,YAFA;QAGAS,YAHA;QAIAR,aAJA;QAKAS,UALA;QAMAC;MANA,CAhBA;MAwBAC;QACAZ,WACA;UAAAa;UAAAC;UAAAC;QAAA,CADA,EAEA;UAAAC;UAAAC;UAAAH;UAAAC;QAAA,CAFA,CADA;QAKAN,WACA;UAAAI;UAAAC;QAAA,CADA;MALA,CAxBA;MAiCAI,cAjCA;MAkCAC;IAlCA;EAoCA,CAtCA;EAuCAC;IACAf;MACAgB,OADA,mBACAC,QADA,EACAC,QADA,EACA;QAAA;;QACA;QACA;UACA;UACAC;YACA;YACA;cACA5B,eADA;cAEAC,gBAFA;cAGA4B,gBAHA;cAIAC,iBAJA;cAKAC,eALA;cAMAC,yBANA;cAOAC;YAPA;UASA,CAXA,EAWA,IAXA;QAYA,CAdA,MAcA;UACA;UACApB;;UACA;YACA;YACA;UACA;QACA;MACA;IAzBA;EADA,CAvCA;EAoEA;EACAqB,OArEA,qBAqEA;IACA;EACA,CAvEA;EAwEAC;IACA;IACAC,YAFA,0BAEA;MACA;MACA;MACAvB;IACA,CANA;IAOA;IACAwB,UARA,sBAQAC,QARA,EAQA;MAAA;;MACA;QACA;UACA;YACA;cACAC,eADA;cAEArB,qBAFA;cAGAsB,eAHA;cAIAC;YAJA;;YAMA;;YACA;UACA,CATA;QAUA,CAXA,MAWA;UACA;QACA;MACA,CAfA;IAgBA,CAzBA;IA0BA;IACAC,SA3BA,qBA2BAJ,QA3BA,EA2BA;MACA;MACAzB;MACA;IACA,CA/BA;IAgCA;IACA8B,SAjCA,qBAiCA9B,QAjCA,EAiCA;MACA;MACA;IACA,CApCA;IAqCA;IACA+B,WAtCA,yBAsCA;MAAA;;MACA;QACAC;UACA/C,qBADA;UAEAD,eAFA;UAGAO,kCAHA;UAIAC;QAJA;MADA,GAOAyC,IAPA,CAOA;QACA;QACA;QACA;QACA;MACA,CAZA;IAaA,CApDA;IAqDA;IACAC,gBAtDA,4BAsDAC,GAtDA,EAsDA;MACA;MACA;IACA,CAzDA;IA0DA;IACAC,mBA3DA,+BA2DAD,GA3DA,EA2DA;MACA;MACA;IACA,CA9DA;IA+DA;IACAE,WAhEA,yBAgEA;MACA;MACA;MACA;IACA,CApEA;IAqEA;IACAC,cAtEA,4BAsEA;MAAA;;MACAvB;QACA;MACA,CAFA,EAEA,IAFA;IAGA,CA1EA;IA2EA;IACAwB,UA5EA,wBA4EA;MACA;MACA;MACA;MACA;IACA,CAjFA;IAkFA;IACAC,UAnFA,sBAmFAC,KAnFA,EAmFAC,GAnFA,EAmFA;MAAA;;MACA;MACA;MACA;MACA;MACA;QACA;QACA;QACA1C;MACA,CAJA;IAKA,CA7FA;IA8FA;IACA2C,YA/FA,wBA+FAF,KA/FA,EA+FAC,GA/FA,EA+FA;MAAA;;MACAE;MACA;QACA;;QACA;MACA,CAHA;IAIA;EArGA;AAxEA","names":["data","size","current","total","videoWidth","videoHeight","faceImgState","searchFace","faceName","faceStatus","tableData","selectImgDialog","currentImg","saveAndUpdateDialog","saveAndUpdateTitle","faceObj","fid","faceBase","remark","addAndUpdateState","rules","required","message","trigger","min","max","faceOption","cameraState","watch","handler","newValue","oldValue","setTimeout","thisCancas","thisContext","thisVideo","canvasId","videoId","created","methods","enteringFace","submitForm","formName","showClose","type","duration","resetForm","selectImg","getFaceList","params","then","handleSizeChange","val","handleCurrentChange","handleClose","setCameraState","handleSave","handleEdit","index","row","handleDelete","console"],"sourceRoot":"src/components/face","sources":["index.vue"],"sourcesContent":["<template>\n  <div>\n\n    <!--条件搜索区域-->\n    <el-row>\n      <el-col :span=\"24\">\n        <el-card header=\"人脸列表\">\n          <el-form :inline=\"true\">\n              <el-form-item label=\"人脸名称\">\n                <el-input\n                    v-model=\"searchFace.faceName\"\n                    placeholder=\"名称\"\n                    clearable>\n                </el-input>\n              </el-form-item>\n            <el-form-item label=\"人脸状态\">\n              <el-select v-model=\"searchFace.faceStatus\" placeholder=\"请选择\">\n                <el-option label=\"不限\" value=\"\"></el-option>\n                <el-option label=\"启用\" value=\"0\"></el-option>\n                <el-option label=\"禁用\" value=\"1\"></el-option>\n              </el-select>\n            </el-form-item>\n            <el-form-item>\n              <el-button icon=\"el-icon-search\" @click=\"getFaceList\">搜索</el-button>\n            </el-form-item>\n          </el-form>\n        </el-card>\n      </el-col>\n    </el-row>\n\n\n    <!--数据显示区域-->\n    <el-row>\n      <el-col :span=\"24\">\n        <el-card>\n          <el-header style=\"background-color: #ffffff\">\n            <el-button @click=\"handleSave()\" icon=\"el-icon-circle-plus-outline\">添加人脸</el-button>\n          </el-header>\n          <el-table\n              :data=\"tableData\"\n              style=\"width: 100%\">\n            <el-table-column\n                width=\"100\"\n                prop=\"fid\"\n                label=\"编号\" sortable>\n            </el-table-column>\n\n            <el-table-column\n                width=\"150\"\n                prop=\"date\"\n                label=\"人脸图片\">\n              <template slot-scope=\"scope\">\n                <el-button icon=\"el-icon-picture-outline\" size=\"mini\" @click=\"selectImg(scope.row.faceBase)\">查看人脸</el-button>\n              </template>\n            </el-table-column>\n\n            <el-table-column\n                prop=\"createTime\"\n                label=\"创建时间\" width=\"200\" sortable>\n            </el-table-column>\n\n            <el-table-column\n                prop=\"vefNum\"\n                label=\"验证次数\" sortable>\n            </el-table-column>\n\n            <el-table-column\n                prop=\"faceName\"\n                label=\"姓名\">\n            </el-table-column>\n\n            <el-table-column\n                prop=\"remark\"\n                label=\"备注\">\n            </el-table-column>\n\n            <el-table-column\n                prop=\"faceStatus\"\n                label=\"是否启用\" sortable>\n              <template slot-scope=\"scope\">\n                <el-switch\n                    :value=\"scope.row.faceStatus===0\"\n                    active-color=\"#13ce66\"\n                    inactive-color=\"#ff4949\">\n                </el-switch>\n              </template>\n            </el-table-column>\n\n            <el-table-column label=\"操作\" width=\"230\">\n              <template slot-scope=\"scope\">\n                <el-button\n                    icon=\"el-icon-edit\"\n                    size=\"mini\"\n                    @click=\"handleEdit(scope.$index, scope.row)\">编辑</el-button>\n                <el-popconfirm\n                :title=\"('确认删除'+scope.row.faceName+'的人脸数据吗?')\"\n                @confirm=\"handleDelete(scope.$index, scope.row)\"\n                >\n                  <el-button\n                      style=\"margin-left: 20px\"\n                      icon=\"el-icon-delete\"\n                      size=\"mini\"\n                      type=\"danger\"  slot=\"reference\">删除</el-button>\n                </el-popconfirm>\n\n              </template>\n            </el-table-column>\n\n          </el-table>\n        </el-card>\n      </el-col>\n    </el-row>\n\n    <!--分页-->\n    <el-row class=\"page-row\">\n      <el-pagination\n          class=\"el-pagination\"\n         @size-change=\"handleSizeChange\"\n         @current-change=\"handleCurrentChange\"\n         layout=\"total, sizes, prev, pager, next, jumper\"\n         :page-sizes=\"[5, 10, 30, 50]\"\n         :current-page=\"current\"\n         :page-size=\"size\"\n         :total=\"total\">\n      </el-pagination>\n    </el-row>\n\n\n\n    <!--查看人脸图片-->\n    <el-dialog\n        title=\"人脸图片\"\n        :visible.sync=\"selectImgDialog\"\n        width=\"30%\">\n        <img style=\"width: 100%;\" :src=\"currentImg\">\n    </el-dialog>\n\n\n    <!-- 添加/修改-->\n    <el-dialog\n    :title=\"saveAndUpdateTitle\"\n    :visible.sync=\"saveAndUpdateDialog\"\n    :before-close=\"handleClose\"\n    width=\"600px\"\n    >\n      <el-form :model=\"faceObj\" :rules=\"rules\" ref=\"ruleForm\" label-width=\"80px\">\n\n        <input type=\"hidden\" v-model=\"faceObj.fid\"></input>\n\n        <el-form-item label=\"人脸名称\" prop=\"faceName\">\n          <el-input placeholder=\"必填项\" v-model=\"faceObj.faceName\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"人脸状态\" style=\"margin-bottom: 30px\" prop=\"faceStatus\">\n          <el-select style=\"width: 100%;\" v-model=\"faceObj.faceStatus\" placeholder=\"请选择\">\n            <el-option label=\"启用\" :value=\"0\"></el-option>\n            <el-option label=\"禁用\" :value=\"1\"></el-option>\n          </el-select>\n        </el-form-item>\n\n        <el-form-item label=\"人脸数据\" class=\"login-mid-mid\" prop=\"faceBase\">\n          <!--捕获人脸区域-->\n          <div class=\"savevideoCamera-canvasCamera \">\n            <video\n                id=\"videoCamera2\"\n                :width=\"videoWidth\"\n                :height=\"videoHeight\"\n                autoplay\n            ></video>\n            <canvas\n                style=\"display: none\"\n                id=\"canvasCamera2\"\n                :width=\"videoWidth\"\n                :height=\"videoHeight\"\n            ></canvas>\n\n            <!--人脸特效区域-->\n            <div v-if=\"faceImgState\" class=\"saveface-special-effects-2\"></div>\n            <div v-else class=\"saveface-special-effects\"></div>\n            <el-input type=\"hidden\" v-model=\"faceObj.faceBase\"></el-input>\n          </div>\n\n          <!--拍照显示区域-->\n          <div class=\"savefaceBase\" id=\"faceBase\">\n\n          </div>\n\n          <!--按钮区域-->\n          <div class=\"saveface-btn\" v-if=\"cameraState\">\n            <el-button @click=\"enteringFace\">{{faceObj.faceBase===''?'录入人脸':'重新录入'}}</el-button>\n          </div>\n          <div class=\"saveface-btn\" v-else>\n            <el-button >摄像头正在加载...</el-button>\n          </div>\n\n        </el-form-item>\n\n\n        <el-form-item label=\"备注\">\n          <el-input placeholder=\"非必填\" type=\"textarea\" v-model=\"faceObj.remark\"></el-input>\n        </el-form-item>\n\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"submitForm('ruleForm')\">立即创建</el-button>\n          <el-button @click=\"resetForm('ruleForm')\">重置</el-button>\n        </el-form-item>\n\n\n      </el-form>\n\n    </el-dialog>\n\n  </div>\n\n\n</template>\n\n<script>\nimport $camera from \"../../camera/index.js\";\nexport default {\n  data() {\n    return {\n      size:5,\n      current:1,\n      total:0,\n      videoWidth: 200,\n      videoHeight: 200,\n      faceImgState:false,\n      searchFace:{\n        faceName:'',\n        faceStatus:''\n      },\n      tableData:[],\n      selectImgDialog:false,\n      currentImg:'',\n      saveAndUpdateDialog:false,\n      saveAndUpdateTitle:'',\n      faceObj:{\n        fid:null,\n        faceName:'',\n        faceBase:'',\n        faceStatus:0,\n        remark:'',\n        addAndUpdateState:false,\n      },\n      rules:{\n        faceName:[\n          { required: true, message: '请输入人脸名称', trigger: 'blur' },\n          { min: 2, max: 5, message: '长度在 2 到 5 个字符', trigger: 'blur' }\n        ],\n        faceBase:[\n          { required: true, message: '人脸数据不能为空'}\n        ]\n      },\n      faceOption:{},\n      cameraState:false\n    }\n  },\n  watch:{\n    saveAndUpdateDialog:{\n      handler(newValue, oldValue){\n        // 监听弹出层 设置摄像头是否开启\n        if (newValue){\n          // 延迟加载 不然document.getElementById找不到\n          setTimeout(()=>{\n            // 开启摄像头\n            this.faceOption = $camera.getCamera({\n              videoWidth: 200,\n              videoHeight: 200,\n              thisCancas: null,\n              thisContext: null,\n              thisVideo: null,\n              canvasId:'canvasCamera2',\n              videoId:'videoCamera2'\n            });\n          },1000)\n        }else {\n          let faceBase = document.getElementById(\"faceBase\");\n          faceBase.innerHTML= \"\"\n          if(this.faceOption.thisVideo != null){\n            // 不等于null 关闭摄像头\n            this.faceOption.thisVideo.srcObject.getTracks()[0].stop();\n          }\n        }\n      }\n    }\n  },\n  // 获取人脸数据\n  created() {\n      this.getFaceList()\n  },\n  methods: {\n    // 录入\n    enteringFace(){\n      this.faceObj.faceBase = $camera.draw(this.faceOption)\n      let faceBase = document.getElementById(\"faceBase\");\n      faceBase.innerHTML = \"<img src='\"+this.faceObj.faceBase+\"' />\"\n    },\n    // 增加|修改\n    submitForm(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          this.$http.post(\"/face/\"+(this.addAndUpdateState?'save':'update'),this.faceObj).then(res =>{\n            this.$message({\n              showClose:true,\n              message:res.data.msg,\n              type:'success',\n              duration:3000\n            })\n            this.getFaceList()\n            this.saveAndUpdateDialog = false\n          })\n        } else {\n          return false;\n        }\n      });\n    },\n    // 重置表单\n    resetForm(formName) {\n      let faceBase = document.getElementById(\"faceBase\");\n      faceBase.innerHTML= \"\"\n      this.$refs[formName].resetFields();\n    },\n    // 查看人脸\n    selectImg(faceBase){\n        this.selectImgDialog = true\n        this.currentImg = faceBase\n    },\n    // 获取人脸列表\n    getFaceList(){\n        this.$http.get('/face/faceList',{\n          params:{\n            current:this.current,\n            size:this.size,\n            faceName:this.searchFace.faceName,\n            faceStatus:this.searchFace.faceStatus\n          }\n        }).then(res =>{\n          this.tableData = res.data.data.records\n          this.size = res.data.data.size\n          this.current = res.data.data.current\n          this.total = res.data.data.total\n        })\n    },\n    // 分页\n    handleSizeChange(val) {\n      this.size = val\n      this.getFaceList()\n    },\n    // 分页\n    handleCurrentChange(val) {\n      this.current = val\n      this.getFaceList()\n    },\n    // 关闭弹出层\n    handleClose() {\n      this.saveAndUpdateDialog = false\n      this.cameraState = false\n      this.resetForm('ruleForm')\n    },\n    // 设置按钮的延迟加载\n    setCameraState(){\n      setTimeout(()=>{\n        this.cameraState = true\n      },1500)\n    },\n    // 添加\n    handleSave(){\n      this.setCameraState()\n      this.addAndUpdateState = true\n      this.saveAndUpdateDialog = true\n      this.saveAndUpdateTitle = '添加人脸'\n    },\n    // 修改\n    handleEdit(index, row) {\n      this.setCameraState()\n      this.addAndUpdateState = false\n      this.saveAndUpdateDialog = true\n      this.saveAndUpdateTitle = '修改人脸'\n      this.$http.get(\"/face/info/\"+row.fid).then(res =>{\n        this.faceObj = res.data.data\n        let faceBase = document.getElementById(\"faceBase\");\n        faceBase.innerHTML = \"<img src='\"+this.faceObj.faceBase+\"' />\"\n      })\n    },\n    //删除\n    handleDelete(index, row) {\n      console.log(index, row);\n      this.$http.get(\"/face/faceDelete/\"+row.fid).then(res =>{\n        this.getFaceList();\n        this.$message.success(res.data.msg)\n      })\n    }\n  }\n}\n</script>\n\n<style>\n@import \"./index.css\";\n</style>"]},"metadata":{},"sourceType":"module"}