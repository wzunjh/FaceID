"use strict";(self["webpackChunkface_id"]=self["webpackChunkface_id"]||[]).push([[102],{94102:(t,e,a)=>{a.r(e),a.d(e,{default:()=>o});a(68309);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"center-container"},[t.authenticated?e("div",{staticClass:"success-message"},[e("el-alert",{attrs:{title:"您已认证成功",type:"success",center:"","show-icon":""}}),e("el-descriptions",{attrs:{title:"您的认证信息"}},[e("el-descriptions-item",{attrs:{label:"姓名"}},[t._v(t._s(t.faceData.name))]),e("el-descriptions-item",{attrs:{label:"用户ID"}},[t._v(t._s(t.faceData.fid))]),e("el-descriptions-item",{attrs:{label:"身份证所在城市地区"}},[t._v(t._s(t.faceData.city))]),e("el-descriptions-item",{attrs:{label:"认证状态"}},[e("el-tag",{attrs:{size:"small"}},[t._v("已认证")])],1),e("el-descriptions-item",{attrs:{label:"18位身份证号码"}},[t._v(t._s(t.faceData.idNo))])],1)],1):e("el-card",{staticClass:"auth-card"},[e("el-steps",{attrs:{active:t.stepActive,"finish-status":"success",simple:""}},[e("el-step",{attrs:{title:"上传图片"}}),e("el-step",{attrs:{title:"正在认证"}}),e("el-step",{attrs:{title:"认证结果"}})],1),e("el-form",{ref:"form",attrs:{model:t.authForm,"label-width":"120px"}},[e("el-form-item",{attrs:{label:"上传身份证图片"}},[e("el-upload",{staticClass:"upload-demo",attrs:{"list-type":"picture-card","file-list":t.fileList,"on-preview":t.handlePreview,"on-remove":t.handleRemove,"before-upload":t.beforeUpload,"http-request":t.handleUpload,limit:1,multiple:""}},[e("i",{staticClass:"el-icon-plus"})]),t.imageSrc?e("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[e("img",{staticStyle:{"max-width":"100%","max-height":"400px"},attrs:{src:t.imageSrc}})]):t._e()],1),e("el-form-item",[e("el-button",{attrs:{type:"primary",disabled:t.submitting},on:{click:function(e){return t.submitForm("form")}}},[t._v("立即认证")])],1)],1)],1)],1)},s=[];a(74916),a(23123),a(41539);const r={data:function(){return{authForm:{fid:"",imageBase:null},imageSrc:null,fileList:[],dialogVisible:!1,authMsg:"",authenticated:!1,faceData:{fid:"",name:"",idNo:"",city:""},submitting:!1,stepActive:0}},mounted:function(){this.authForm.fid=localStorage.getItem("user_id"),this.checkAuthentication()},methods:{checkAuthentication:function(){var t=this;this.$http.get("/face/orAuth/".concat(this.authForm.fid)).then((function(e){200===e.data.code&&(t.authenticated=!0,t.fetchAuthInfo())}))["catch"]((function(t){console.error("Error checking authentication:",t)}))},fetchAuthInfo:function(){var t=this;this.$http.get("/face/authUser/".concat(this.authForm.fid)).then((function(e){200===e.data.code&&(t.faceData=e.data)}))["catch"]((function(t){console.error("Error fetching user info:",t)}))},handleFileChange:function(t){var e=this,a=t.target.files[0];if(a){var i=new FileReader;i.onload=function(t){e.imageSrc=t.target.result,e.authForm.imageBase=t.target.result.split(",")[1]},i.readAsDataURL(a)}},submitForm:function(t){var e=this;this.stepActive=1,this.submitting=!0,this.$refs[t].validate((function(t){if(!t)return!1;var a=new FormData;a.append("fid",e.authForm.fid),a.append("imageBase",e.authForm.imageBase),e.$http.post("/face/auth",a,{headers:{"Content-Type":"multipart/form-data"}}).then((function(t){e.stepActive=2,200===t.data.code||202===t.data.code?(e.authMsg=t.data.msg,e.authenticated=!0,e.fetchAuthInfo(),e.stepActive=3):(e.authMsg=t.data.msg||"认证请求失败",e.stepActive=0)}))["catch"]((function(t){console.error("Authentication failed:",t),e.authMsg="认证请求失败",e.stepActive=0}))["finally"]((function(){e.submitting=!1}))}))},beforeUpload:function(t){var e="image/jpeg"===t.type||"image/png"===t.type;return!!e||(this.$message.error("Only JPEG or PNG images are allowed!"),!1)},handleUpload:function(t){var e=this,a=new FileReader;return a.onload=function(t){e.imageSrc=t.target.result,e.authForm.imageBase=t.target.result.split(",")[1]},a.readAsDataURL(t.file),!1},handlePreview:function(t){this.imageSrc=t.url},handleRemove:function(t,e){this.imageSrc=e.length>0?e[0].url:""}}},n=r;var c=a(1001),l=(0,c.Z)(n,i,s,!1,null,"21dd6dac",null);const o=l.exports}}]);
//# sourceMappingURL=102.12db1d05.js.map