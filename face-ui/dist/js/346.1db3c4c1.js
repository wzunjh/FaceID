"use strict";(self["webpackChunkface_id"]=self["webpackChunkface_id"]||[]).push([[346],{74346:(e,o,n)=>{n.r(o),n.d(o,{default:()=>l});var t=function(){var e=this,o=e._self._c;return o("div",[e.phoneBound?e.modifyPhoneVisible?1===e.modifyPhoneStep?o("el-card",{attrs:{header:"修改手机号绑定"}},[o("el-form",{ref:"modifyPhoneForm",attrs:{model:e.modifyPhoneForm,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"验证方式",prop:"verifyType"}},[o("el-radio-group",{model:{value:e.modifyPhoneForm.verifyType,callback:function(o){e.$set(e.modifyPhoneForm,"verifyType",o)},expression:"modifyPhoneForm.verifyType"}},[o("el-radio",{attrs:{label:"phone"}},[e._v("原手机号验证")]),o("el-radio",{attrs:{label:"apikey"}},[e._v("API Key 验证")])],1)],1),"phone"===e.modifyPhoneForm.verifyType?[o("el-form-item",{attrs:{label:"原手机号码",prop:"oldPhone"}},[o("el-input",{attrs:{clearable:"",disabled:""},model:{value:e.modifyPhoneForm.oldPhone,callback:function(o){e.$set(e.modifyPhoneForm,"oldPhone",o)},expression:"modifyPhoneForm.oldPhone"}})],1),o("el-form-item",{attrs:{label:"验证码",prop:"oldCode"}},[o("el-input",{attrs:{clearable:""},model:{value:e.modifyPhoneForm.oldCode,callback:function(o){e.$set(e.modifyPhoneForm,"oldCode",o)},expression:"modifyPhoneForm.oldCode"}}),o("el-button",{attrs:{disabled:e.oldPhoneCountdown>0},on:{click:function(o){return e.sendCode("old")}}},[e._v("发送验证码"+e._s(e.oldPhoneCountdown?"(".concat(e.oldPhoneCountdown,"s)"):""))])],1)]:"apikey"===e.modifyPhoneForm.verifyType?[o("el-form-item",{attrs:{label:"API Key",prop:"apiKey"}},[o("el-input",{attrs:{clearable:""},model:{value:e.modifyPhoneForm.apiKey,callback:function(o){e.$set(e.modifyPhoneForm,"apiKey",o)},expression:"modifyPhoneForm.apiKey"}})],1)]:e._e(),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:function(o){return e.submitVerification("modifyPhoneForm")}}},[e._v("提交验证")])],1)],2)],1):2===e.modifyPhoneStep?o("el-card",{attrs:{header:"修改手机号绑定"}},[o("el-form",{ref:"modifyPhoneForm",attrs:{model:e.modifyPhoneForm,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"新手机号码",prop:"newPhone"}},[o("el-input",{attrs:{clearable:""},model:{value:e.modifyPhoneForm.newPhone,callback:function(o){e.$set(e.modifyPhoneForm,"newPhone",o)},expression:"modifyPhoneForm.newPhone"}})],1),o("el-form-item",{attrs:{label:"验证码",prop:"newCode"}},[o("el-input",{attrs:{clearable:""},model:{value:e.modifyPhoneForm.newCode,callback:function(o){e.$set(e.modifyPhoneForm,"newCode",o)},expression:"modifyPhoneForm.newCode"}}),o("el-button",{attrs:{disabled:e.newPhoneCountdown>0},on:{click:function(o){return e.sendCode("new")}}},[e._v("发送验证码"+e._s(e.newPhoneCountdown?"(".concat(e.newPhoneCountdown,"s)"):""))])],1),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:function(o){return e.submitNewPhoneForm("modifyPhoneForm")}}},[e._v("提交修改")])],1)],1)],1):e._e():o("el-card",{staticClass:"mb-4",attrs:{header:"手机号绑定成功"}},[o("el-alert",{attrs:{title:"手机号绑定成功",type:"success",center:"","show-icon":""}}),o("el-descriptions",{attrs:{title:"您的绑定信息"}},[o("el-descriptions-item",{attrs:{label:"用户ID"}},[e._v(e._s(e.phoneData.fid))]),o("el-descriptions-item",{attrs:{label:"绑定手机号码"}},[e._v(e._s(e.phoneData.phone))]),o("el-descriptions-item",{attrs:{label:"绑定状态"}},[o("el-tag",{attrs:{size:"small"}},[e._v("已绑定")])],1)],1),o("div",{staticClass:"d-flex justify-content-center"},[o("el-button",{attrs:{type:"primary"},on:{click:e.showModifyPhoneForm}},[e._v("修改手机号")])],1)],1):o("el-card",{attrs:{header:"手机核验绑定"}},[o("el-form",{ref:"phoneForm",attrs:{model:e.phoneAuthForm,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"手机号码",prop:"phone"}},[o("el-input",{attrs:{clearable:""},model:{value:e.phoneAuthForm.phone,callback:function(o){e.$set(e.phoneAuthForm,"phone",o)},expression:"phoneAuthForm.phone"}})],1),o("el-form-item",{attrs:{label:"验证码",prop:"code"}},[o("el-input",{attrs:{clearable:""},model:{value:e.phoneAuthForm.code,callback:function(o){e.$set(e.phoneAuthForm,"code",o)},expression:"phoneAuthForm.code"}})],1),o("el-form-item",[o("el-button",{attrs:{disabled:e.phoneCountdown>0},on:{click:function(o){return e.sendCode("phone")}}},[e._v("发送验证码"+e._s(e.phoneCountdown?"(".concat(e.phoneCountdown,"s)"):""))]),o("el-button",{attrs:{type:"primary"},on:{click:function(o){return e.submitPhoneForm("phoneForm")}}},[e._v("提交核验")])],1)],1)],1)],1)},i=[];n(32564),n(74916),n(77601);const r={data:function(){return{phoneAuthForm:{phone:"",code:"",fid:""},modifyPhoneForm:{verifyType:"phone",oldPhone:"",oldCode:"",apiKey:"",newPhone:"",newCode:""},phoneBound:!1,phoneData:{fid:"",phone:""},phoneCountdown:0,oldPhoneCountdown:0,newPhoneCountdown:0,modifyPhoneVisible:!1,modifyPhoneStep:1}},mounted:function(){this.phoneAuthForm.fid=localStorage.getItem("user_id"),this.checkPhoneBinding()},methods:{checkPhoneBinding:function(){var e=this;this.$http.get("/face/SmsC/".concat(this.phoneAuthForm.fid)).then((function(o){200===o.data.code&&(e.phoneBound=!0,e.phoneData.phone=o.data.phone,e.phoneData.fid=o.data.fid,e.modifyPhoneForm.oldPhone=o.data.phone)}))["catch"]((function(e){console.error("Error checking phone binding:",e)}))},sendCode:function(e){var o=this,n=0;switch(e){case"phone":n=this.phoneCountdown;break;case"old":n=this.oldPhoneCountdown;break;case"new":n=this.newPhoneCountdown;break}if(!(n>0)){n=60;var t=setInterval((function(){switch(n--,0===n&&clearInterval(t),e){case"phone":o.phoneCountdown=n;break;case"old":o.oldPhoneCountdown=n;break;case"new":o.newPhoneCountdown=n;break}}),1e3),i="";switch(e){case"phone":i=this.phoneAuthForm.phone;break;case"old":i=this.modifyPhoneForm.oldPhone;break;case"new":if(!/^1\d{10}$/.test(this.modifyPhoneForm.newPhone))return void alert("非法手机号");i=this.modifyPhoneForm.newPhone;break}this.$http.get("/face/Sms",{params:{phone:i}}).then((function(e){alert(e.data.msg)}))["catch"]((function(e){console.error("Failed to send code:",e)}))}},submitPhoneForm:function(e){var o=this;this.$refs[e].validate((function(e){if(!e)return!1;o.$http.get("/face/SmsVef",{params:{fid:o.phoneAuthForm.fid,phone:o.phoneAuthForm.phone,code:o.phoneAuthForm.code}}).then((function(e){200===e.data.code?(o.phoneBound=!0,o.checkPhoneBinding()):alert(e.data.msg)}))["catch"]((function(e){console.error("Phone verification failed:",e)}))}))},showModifyPhoneForm:function(){this.modifyPhoneVisible=!0,this.modifyPhoneStep=1},submitVerification:function(e){var o=this;this.$refs[e].validate((function(e){if(!e)return!1;"phone"===o.modifyPhoneForm.verifyType?o.$http.get("/face/SmsVef",{params:{fid:o.phoneAuthForm.fid,phone:o.modifyPhoneForm.oldPhone,code:o.modifyPhoneForm.oldCode}}).then((function(e){200===e.data.code?o.modifyPhoneStep=2:alert(e.data.msg)}))["catch"]((function(e){console.error("Old phone verification failed:",e)})):"apikey"===o.modifyPhoneForm.verifyType&&o.$http.get("/face/log/vef",{params:{fid:o.phoneAuthForm.fid,Auth:o.modifyPhoneForm.apiKey}}).then((function(e){200===e.data.code?o.modifyPhoneStep=2:alert(e.data.msg)}))["catch"]((function(e){console.error("API key verification failed:",e)}))}))},submitNewPhoneForm:function(e){var o=this;this.$refs[e].validate((function(e){if(!e)return!1;o.$http.get("/face/SmsVef",{params:{fid:o.phoneAuthForm.fid,phone:o.modifyPhoneForm.newPhone,code:o.modifyPhoneForm.newCode}}).then((function(e){200===e.data.code?(o.phoneBound=!0,o.checkPhoneBinding(),o.modifyPhoneVisible=!1,o.modifyPhoneStep=1):alert(e.data.msg)}))["catch"]((function(e){console.error("New phone verification failed:",e)}))}))}}},a=r;var h=n(1001),d=(0,h.Z)(a,t,i,!1,null,"b59337d2",null);const l=d.exports}}]);
//# sourceMappingURL=346.1db3c4c1.js.map