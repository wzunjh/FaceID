{"version":3,"file":"js/102.12db1d05.js","mappings":"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","sources":["webpack://face-id/./src/components/IdAuth/index.vue","webpack://face-id/src/components/IdAuth/index.vue","webpack://face-id/./src/components/IdAuth/index.vue?615c","webpack://face-id/./src/components/IdAuth/index.vue?41de"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"center-container\"},[(!_vm.authenticated)?_c('el-card',{staticClass:\"auth-card\"},[_c('el-steps',{attrs:{\"active\":_vm.stepActive,\"finish-status\":\"success\",\"simple\":\"\"}},[_c('el-step',{attrs:{\"title\":\"上传图片\"}}),_c('el-step',{attrs:{\"title\":\"正在认证\"}}),_c('el-step',{attrs:{\"title\":\"认证结果\"}})],1),_c('el-form',{ref:\"form\",attrs:{\"model\":_vm.authForm,\"label-width\":\"120px\"}},[_c('el-form-item',{attrs:{\"label\":\"上传身份证图片\"}},[_c('el-upload',{staticClass:\"upload-demo\",attrs:{\"list-type\":\"picture-card\",\"file-list\":_vm.fileList,\"on-preview\":_vm.handlePreview,\"on-remove\":_vm.handleRemove,\"before-upload\":_vm.beforeUpload,\"http-request\":_vm.handleUpload,\"limit\":1,\"multiple\":\"\"}},[_c('i',{staticClass:\"el-icon-plus\"})]),(_vm.imageSrc)?_c('div',{staticStyle:{\"text-align\":\"center\",\"margin-top\":\"20px\"}},[_c('img',{staticStyle:{\"max-width\":\"100%\",\"max-height\":\"400px\"},attrs:{\"src\":_vm.imageSrc}})]):_vm._e()],1),_c('el-form-item',[_c('el-button',{attrs:{\"type\":\"primary\",\"disabled\":_vm.submitting},on:{\"click\":function($event){return _vm.submitForm('form')}}},[_vm._v(\"立即认证\")])],1)],1)],1):_c('div',{staticClass:\"success-message\"},[_c('el-alert',{attrs:{\"title\":\"您已认证成功\",\"type\":\"success\",\"center\":\"\",\"show-icon\":\"\"}}),_c('el-descriptions',{attrs:{\"title\":\"您的认证信息\"}},[_c('el-descriptions-item',{attrs:{\"label\":\"姓名\"}},[_vm._v(_vm._s(_vm.faceData.name))]),_c('el-descriptions-item',{attrs:{\"label\":\"用户ID\"}},[_vm._v(_vm._s(_vm.faceData.fid))]),_c('el-descriptions-item',{attrs:{\"label\":\"身份证所在城市地区\"}},[_vm._v(_vm._s(_vm.faceData.city))]),_c('el-descriptions-item',{attrs:{\"label\":\"认证状态\"}},[_c('el-tag',{attrs:{\"size\":\"small\"}},[_vm._v(\"已认证\")])],1),_c('el-descriptions-item',{attrs:{\"label\":\"18位身份证号码\"}},[_vm._v(_vm._s(_vm.faceData.idNo))])],1)],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"center-container\">\r\n    <el-card v-if=\"!authenticated\" class=\"auth-card\">\r\n      <el-steps :active=\"stepActive\" finish-status=\"success\" simple>\r\n        <el-step title=\"上传图片\"></el-step>\r\n        <el-step title=\"正在认证\"></el-step>\r\n        <el-step title=\"认证结果\"></el-step>\r\n      </el-steps>\r\n      <el-form ref=\"form\" :model=\"authForm\" label-width=\"120px\">\r\n        <el-form-item label=\"上传身份证图片\">\r\n          <el-upload\r\n              class=\"upload-demo\"\r\n              list-type=\"picture-card\"\r\n              :file-list=\"fileList\"\r\n              :on-preview=\"handlePreview\"\r\n              :on-remove=\"handleRemove\"\r\n              :before-upload=\"beforeUpload\"\r\n              :http-request=\"handleUpload\"\r\n              :limit=\"1\"\r\n              multiple>\r\n            <i class=\"el-icon-plus\"></i>\r\n          </el-upload>\r\n          <div v-if=\"imageSrc\" style=\"text-align: center; margin-top: 20px;\">\r\n            <img :src=\"imageSrc\" style=\"max-width: 100%; max-height: 400px;\" />\r\n          </div>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button type=\"primary\" @click=\"submitForm('form')\" :disabled=\"submitting\">立即认证</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-card>\r\n    <div v-else class=\"success-message\">\r\n      <el-alert title=\"您已认证成功\" type=\"success\" center show-icon />\r\n      <el-descriptions title=\"您的认证信息\">\r\n        <el-descriptions-item label=\"姓名\">{{ faceData.name }}</el-descriptions-item>\r\n        <el-descriptions-item label=\"用户ID\">{{ faceData.fid }}</el-descriptions-item>\r\n        <el-descriptions-item label=\"身份证所在城市地区\">{{ faceData.city }}</el-descriptions-item>\r\n        <el-descriptions-item label=\"认证状态\">\r\n          <el-tag size=\"small\">已认证</el-tag>\r\n        </el-descriptions-item>\r\n        <el-descriptions-item label=\"18位身份证号码\">{{ faceData.idNo }}</el-descriptions-item>\r\n      </el-descriptions>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      authForm: {\r\n        fid: '',\r\n        imageBase: null\r\n      },\r\n      imageSrc: null,\r\n      fileList: [],\r\n      dialogVisible: false,\r\n      authMsg: '',\r\n      authenticated: false,\r\n      faceData: { fid: '', name: '', idNo: '', city: '' },\r\n      submitting: false,\r\n      stepActive: 0\r\n    };\r\n  },\r\n  mounted() {\r\n    this.authForm.fid = localStorage.getItem('user_id');\r\n    this.checkAuthentication();\r\n  },\r\n  methods: {\r\n    checkAuthentication() {\r\n      this.$http.get(`/face/orAuth/${this.authForm.fid}`).then(response => {\r\n        if (response.data.code === 200) {\r\n          this.authenticated = true;\r\n          this.fetchAuthInfo();\r\n        }\r\n      }).catch(error => {\r\n        console.error('Error checking authentication:', error);\r\n      });\r\n    },\r\n    fetchAuthInfo() {\r\n      this.$http.get(`/face/authUser/${this.authForm.fid}`).then(response => {\r\n        if (response.data.code === 200) {\r\n          this.faceData = response.data;\r\n        }\r\n      }).catch(error => {\r\n        console.error('Error fetching user info:', error);\r\n      });\r\n    },\r\n    handleFileChange(event) {\r\n      const file = event.target.files[0];\r\n      if (file) {\r\n        const reader = new FileReader();\r\n        reader.onload = (e) => {\r\n          this.imageSrc = e.target.result;\r\n          this.authForm.imageBase = e.target.result.split(',')[1]; // Assuming the result is in base64 format\r\n        };\r\n        reader.readAsDataURL(file);\r\n      }\r\n    },\r\n    submitForm(formName) {\r\n      this.stepActive = 1;\r\n      this.submitting = true;\r\n      this.$refs[formName].validate(valid => {\r\n        if (valid) {\r\n          let formData = new FormData();\r\n          formData.append('fid', this.authForm.fid);\r\n          formData.append('imageBase', this.authForm.imageBase);\r\n\r\n          this.$http.post('/face/auth', formData, {\r\n            headers: {\r\n              'Content-Type': 'multipart/form-data'\r\n            }\r\n          }).then(response => {\r\n            this.stepActive = 2\r\n            if (response.data.code === 200 || response.data.code === 202) {\r\n              this.authMsg = response.data.msg;\r\n              this.authenticated = true;\r\n              this.fetchAuthInfo();\r\n              this.stepActive = 3; // Move to the final step in the progress bar\r\n            } else {\r\n              this.authMsg = response.data.msg || '认证请求失败';\r\n              this.stepActive = 0; // Reset step on failure\r\n            }\r\n          }).catch(error => {\r\n            console.error('Authentication failed:', error);\r\n            this.authMsg = '认证请求失败';\r\n            this.stepActive = 0; // Reset step on failure\r\n          }).finally(() => {\r\n            this.submitting = false;\r\n          });\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    beforeUpload(file) {\r\n      const isImage = file.type === 'image/jpeg' || file.type === 'image/png';\r\n      if (!isImage) {\r\n        this.$message.error('Only JPEG or PNG images are allowed!');\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n    handleUpload(file) {\r\n      const reader = new FileReader();\r\n      reader.onload = (e) => {\r\n        this.imageSrc = e.target.result;\r\n        this.authForm.imageBase = e.target.result.split(',')[1]; // Assuming the result is in base64 format\r\n      };\r\n      reader.readAsDataURL(file.file);\r\n      return false; // Prevent default upload behavior\r\n    },\r\n    handlePreview(file) {\r\n      this.imageSrc = file.url;\r\n    },\r\n    handleRemove(file, fileList) {\r\n      this.imageSrc = fileList.length > 0 ? fileList[0].url : '';\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.auth-card {\r\n  width: 600px;\r\n  margin: auto;\r\n}\r\n\r\n.center-container {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  min-height: 100vh;\r\n}\r\n\r\n.upload-demo {\r\n  display: flex;\r\n  justify-content: center;\r\n  margin: 20px 0;\r\n}\r\n\r\n.success-message {\r\n  color: green;\r\n  padding: 20px;\r\n  border: 1px solid #e0e0e0;\r\n  border-radius: 5px;\r\n  margin-top: -750px; /* 负值表示向上移动 */\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=21dd6dac&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=21dd6dac&prod&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"21dd6dac\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","authenticated","attrs","_v","_s","faceData","name","fid","city","idNo","stepActive","ref","authForm","fileList","handlePreview","handleRemove","beforeUpload","handleUpload","imageSrc","staticStyle","_e","submitting","on","$event","submitForm","staticRenderFns","data","imageBase","dialogVisible","authMsg","mounted","methods","checkAuthentication","console","fetchAuthInfo","handleFileChange","event","reader","formName","formData","headers","then","file","component"],"sourceRoot":""}